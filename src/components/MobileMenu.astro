---
import { links, hasChildren, type NavLinkGroup } from "@/lib/nav-links";
import createSlug from "@/lib/create-slug";
import X from "@/components/X.astro";
import ChevronDown from "@/components/ChevronDown.astro";
import Hamburger from "@/components/Hamburger.astro";
import ChevronUp from "./ChevronUp.astro";

const collapseId = (link: NavLinkGroup) =>
  "s-collapse-" + createSlug(link.text);
const collapseTriggerId = (link: NavLinkGroup) => "show-" + collapseId(link);
const mobileMenuId = "mobile-menu";
---

<button
  class="rounded-lg px-5 py-2.5 text-center text-sm font-medium text-zinc-600 focus:outline-none focus:ring-4 focus:ring-blue-300 lg:hidden"
  type="button"
  aria-label="Show mobile menu"
  aria-controls={mobileMenuId}
  data-drawer-target={mobileMenuId}
  data-drawer-show={mobileMenuId}
  data-drawer-placement="right"
>
  <Hamburger />
</button>

<div
  id={mobileMenuId}
  class="fixed right-0 top-0 z-40 h-screen w-80 translate-x-full overflow-y-auto bg-white p-4 transition-transform lg:hidden [&>*]:aria-[hidden=true]:hidden"
  tabindex="-1"
  aria-labelledby="mobile-menu-label"
>
  <h5
    id="mobile-menu-label"
    class="text-base font-semibold uppercase text-gray-500"
  >
    Menu
  </h5>
  <button
    type="button"
    aria-controls={mobileMenuId}
    data-drawer-hide={mobileMenuId}
    class="absolute end-2.5 top-2.5 inline-flex h-8 w-8 items-center justify-center rounded-lg bg-transparent text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900"
  >
    <X height={12} width={12} />
    <span class="sr-only">Close menu</span>
  </button>
  <div class="overflow-y-auto py-4">
    <ul class="space-y-2 font-medium">
      {
        links.map((link) =>
          hasChildren(link) ? (
            <li>
              <button
                id={collapseTriggerId(link)}
                type="button"
                aria-expanded="false"
                aria-controls={collapseId(link)}
                data-collapse-toggle={collapseId(link)}
                class="group flex w-full items-center rounded-lg p-2 text-base text-gray-900 transition duration-75 hover:bg-gray-100 [&>.collapse-icon]:aria-[expanded=false]:hidden [&>.expand-icon]:aria-[expanded=true]:hidden"
              >
                <span class="ms-3 flex-1 whitespace-nowrap text-left">
                  {link.text}
                </span>
                <ChevronDown class="expand-icon" height={12} width={12} />
                <ChevronUp class="collapse-icon" height={12} width={12} />
              </button>
              <ul
                id={collapseId(link)}
                aria-labelledby={collapseTriggerId(link)}
                class="hidden space-y-2 py-2"
              >
                {link.children.map((child) => (
                  <li>
                    <a
                      href={child.href}
                      class="group flex w-full items-center rounded-lg p-2 pl-11 text-gray-900 transition duration-75 hover:bg-gray-100"
                    >
                      {child.text}
                    </a>
                  </li>
                ))}
              </ul>
            </li>
          ) : (
            <li>
              <a
                href={link.href}
                class="group flex items-center rounded-lg p-2 text-gray-900 hover:bg-gray-100"
              >
                <span class="ms-3">{link.text}</span>
              </a>
            </li>
          )
        )
      }
    </ul>
  </div>
</div>

<script>
  import { initCollapses } from "flowbite/lib/esm/components/collapse";
  import { initDrawers } from "flowbite/lib/esm/components/drawer";

  document.addEventListener("astro:page-load", () => {
    initCollapses();
    initDrawers();
  });
</script>
